<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
		<title>商品发布</title>
		<!-- Bootstrap -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/index.css" />
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	</head>

	<body>
		<div class="container">
			<div class=" col-lg-2 ">
				<div style="text-align: center;">
					<div class="shop-box">
						<img src="img/pic_03.png" />
						<p><b>博客</b></p>
					</div>
				</div>
				<div>
					<a href="shop-issue.html">
						<div class="shopping">
							发布文章
						</div>
					</a>

				</div>
			</div>
			<div class=" col-lg-10 ">
				<!-- Tab panes -->
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane  active" id="home">
						<div class="top clearfix">
							<div class="top-pic fl">
								<img src="img/images/pic1_03.png" />
							</div>
							<div class="top-title fl">
								博客发布
							</div>
						</div>
						<div class="name">
							发布文章
						</div>
						<form action="" method="post" id="l-form">
							<table class="table table-bordered">
								<tr>
									<th colspan="2" class="shop-message ">基本信息</th>
								</tr>
								<tr>
									<td class="txt-class col-lg-2"><span style="color: red;">*</span>文章分类</td>
									<td class="col-lg-10">
										<select class="form-control shop-select" name="sort" id="sort">
											<option value="技术">技术</option>
											<option value="设计">设计</option>
											<option value="生活">生活</option>

										</select>

									</td>
								</tr>
								<tr>
									<td class="txt-class col-lg-2">文章标题</td>
									<td class="col-lg-10 ">
										<div class="">
											<input type="text" name="textName" class="form-control shop-inputname" datatype="s" nullmsg="请输入文章标题！" id="shop-name" placeholder="文章标题">
										</div>
										<span></span>
										<div class="input-intro">文章标题名称长度至少3个字符，最长50个汉字</div>
									</td>
								</tr>
								<tr>
									<td class="txt-class col-lg-2"> 标签</td>
									<td class="col-lg-10 ">
										<div class="">
											<input type="hidden" name="textTags" id="textTags" />
											<input type="text" id="tags" datatype="*" nullmsg="请输入标签！" placeholder="标签" class="form-control shop-short">
										</div>
										<span></span>
										<p class="input-intro">
											多个标签请以空格" "隔开
										</p>
									</td>
								</tr>
								<tr>
									<td class="txt-class col-lg-2">文章摘要</td>
									<td class="col-lg-10 ">
										<div id="">
											<textarea name="textmain" class="form-control shop-inputname" datatype="*" nullmsg="请输入文章摘要！" errormsg="最长不能超过140个汉字" rows="4"></textarea>
										</div>
										<span></span>
										<p class="input-intro">摘要最长不能超过140个汉字</p>
									</td>
								</tr>
								<tr>
									<td class="txt-class col-lg-2">文章主图</td>
									<td class="col-lg-10 ">
										<div class="shop-mainbox">
										</div>
										<!--隐藏数据-->
										<input type="hidden" name="lgImg" id="lgImg" value="" />
										<input type="hidden" name="mdImg" id="mdImg" value="" />

										<p class="input-intro">
											上传文章默认主图，如多规格时将默认使用图片或分规格主图，支持jpg、gif、png、格式上传成或从图片空间 选着，建议使用尺寸800*800像素、大小不超过1M的正方形图片，上传后的图片将会自动保存在图片空间的默认分类中。
										</p>
										<div class="pic_btn relative">
											<input type="file" name="" id="fbtn" value="" />
											<input type="button" name="" id="pbtn" value="图片上传" />
										</div>
									</td>
								</tr>

								<tr>
									<td class="txt-class col-lg-2"> 文章内容</td>
									<td class="col-lg-10 ">
										<div id="editor">
										</div>
										<textarea id="detail" name="textContent" style="display: none;"></textarea>
									</td>
								</tr>
							</table>
							<div class="sub">
								<input class="btn" type="button" name="" id="submit" value="发布" />
							</div>
							<input type="hidden" name="timer" id="time" value="" />
							<input type="hidden" name="postTime" id="" value="" />
							<input type="hidden" name="comments" id="" value="" />
						</form>
					</div>
				</div>
			</div>
		</div>
	</body>
	<!--<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>-->
	<script src="js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/Validform_v5.3.2.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/template-web.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/wangEditor.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/PCASClass.js" type="text/javascript" charset="utf-8"></script>
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<!--<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>-->
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="js/bootstrap.min.js"></script>
	<script type="text/javascript">
		var E = window.wangEditor
		var editor = new E('#editor')
		var $detail = $('#detail')
		editor.customConfig.onchange = function(html) {
			// 监控变化，同步更新到 textarea
			$detail.val(html)
		}

		// 配置服务器端地址
		editor.customConfig.uploadImgServer = '/api/upload/common/'
		//自定义filename
		editor.customConfig.uploadFileName = 'file'
		editor.create()
		// 初始化 textarea 的值
		$detail.val(editor.txt.html())
	</script>
	<script type="text/javascript">
		
	</script>
	<!--<script type="text/html" id="tpl-one">
		{{each data}}
		<option value="{{$value.id}}">{{$value.name}}</option>

		{{/each}}
	</script>-->
	<script type="text/javascript">
		//表单序列化为对象
		function serializeObject(form) {

			var o = {};
			$.each(form.serializeArray(), function(index) {
				if(o[this['name']]) {
					o[this['name']] = o[this['name']] + ";" + this['value'];
				} else {
					o[this['name']] = this['value'];
				}
			});
			return o;
		}
	</script>
	<!--图片上传-->
	<script type="text/javascript">
		//AJAX提交文件
		$(document).ready(function() {
			//商品主图上传
			$("#fbtn").change(function() {
				var formData = new FormData();
				//file对象
				var oFile = $(this)[0].files[0];
				formData.append("file", oFile);
				$.ajax({
					type: "post",
					url: "/api/upload/img/",
					async: true,
					contentType: false,
					processData: false,
					data: formData,
					success: function(result) {
						if(result.status) {
							//在div插入图片
							$(".shop-mainbox").html('<img src="' + result.mdImg + '" />')
							//隐藏数据
							$("#lgImg").val(result.lgImg)
							$("#mdImg").val(result.mdImg)

						} else {
							alert(result.msg)
						}
					}
				});

			});

			//表单验证
			$(function() {
				var arr = [];
				var otime = "";
				var otime2 = '';
				$("#l-form").Validform({
					btnSubmit: "#submit",
					tiptype: 2,
					ajaxPost: true,

					beforeSubmit: function(curform) {

						//获取时间
						$.get('/api/getTime/', function(result) {
							if(result.status) {
								otime = result.time
								otime2 = result.time2

								console.log(otime)
								//在验证成功后，表单提交前执行的函数，curform参数是当前表单对象。
								//这里明确return false的话表单将不会提交;	
								arr = $("#tags").val().split(" ");
								console.log(arr);

								var data = serializeObject($('form'))
								data.textTags = arr;
								data.timer = otime;
								data.postTime = otime2;
								console.log(data);
								$.post('/api/blog/', data, function(result) {
									if(result.status) {
										alert(result.msg);
									}
								});
//								var data2={
//									"textTags":data.textTags
//								}
//								$.post('/api/blogtags/', data2, function(result) {
//									if(result.status) {
////										alert(result.msg);
//									}
//								});

							}
						});
						return false;
					},

				});
			})

		})
	</script>

</html>